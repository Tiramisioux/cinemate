15.594: INFO: main               Contents of /home/pi/cinemate/src/logs/cinemate-service-error.log have been erased.
16.079: INFO: wifi_hotspot       Wi-Fi hotspot 'CinePi' created successfully with password '11111111' on interface 'wlan0'.
16.108: INFO: redis_controller   Initializing cache with Redis values...
16.110: INFO: PWMcontroller      Initializing PWM on pin 19 (channel 3) with frequency 24Hz and chip 2
16.110: INFO: redis_controller   Changed value: pi_model = pi5
16.113: INFO: PWMcontroller      PWM successfully initialized on pin 19 (channel 3) with frequency 24Hz
16.114: INFO: PWMcontroller      Updating PWM with cycles=1
16.125: INFO: PWMcontroller      PWM duty cycle set to 49.999237048905165% on pins 19, None
38.153: INFO: sensor_detect      cinepi-raw output: Available cameras
-----------------
0 : imx477 [4056x3040 12-bit RGGB] (/base/axi/pcie@120000/rp1/i2c@80000/imx477@1a)
    Modes: 'SRGGB10_CSI2P' : 1332x990 [120.05 fps - (696, 528)/2664x1980 crop]
           'SRGGB12_CSI2P' : 2028x1080 [50.03 fps - (0, 440)/4056x2160 crop]
                             2028x1520 [40.01 fps - (0, 0)/4056x3040 crop]
                             4056x3040 [10.00 fps - (0, 0)/4056x3040 crop]


38.153: INFO: sensor_detect      Detected camera model: imx477
38.154: WARNING: sensor_detect      cinepi-raw command exited with non-zero status: 134
38.154: WARNING: sensor_detect      stderr: terminate called after throwing an instance of 'std::system_error'
  what():  Invalid argument
Aborted

38.419: INFO: sensor_detect      cinepi-raw output: Available cameras
-----------------
0 : imx477 [4056x3040 12-bit RGGB] (/base/axi/pcie@120000/rp1/i2c@80000/imx477@1a)
    Modes: 'SRGGB10_CSI2P' : 1332x990 [120.05 fps - (696, 528)/2664x1980 crop]
           'SRGGB12_CSI2P' : 2028x1080 [50.03 fps - (0, 440)/4056x2160 crop]
                             2028x1520 [40.01 fps - (0, 0)/4056x3040 crop]
                             4056x3040 [10.00 fps - (0, 0)/4056x3040 crop]


38.419: INFO: sensor_detect      Detected camera model: imx477
38.419: WARNING: sensor_detect      cinepi-raw command exited with non-zero status: 134
38.419: WARNING: sensor_detect      stderr: terminate called after throwing an instance of 'std::system_error'
  what():  Invalid argument
Aborted

38.420: INFO: cinepi_app         Corrected Preview Window -> x=94, y=79, width=1732, height=922, aspect_ratio=1.88
38.420: INFO: redis_controller   Changed value: anamorphic_factor = 1
38.420: INFO: cinepi_app         redis width: 2028
38.420: INFO: cinepi_app         redis height: 1080
38.421: INFO: cinepi_app         CinePi instantiated
38.421: INFO: cinepi_app         Log level set to INFO
38.421: INFO: redis_controller   Changed value: lores_width = 1352
38.421: INFO: cinepi_app         Active filters set to: 
38.421: INFO: redis_controller   Changed value: lores_height = 720
38.421: INFO: ssd_monitor        SSD monitoring thread started.
38.424: INFO: ssd_monitor        RAW drive mounted at /media/RAW
38.424: INFO: ssd_monitor        Updated space left on SSD: 107.45 GB
38.449: INFO: gpio_output        REC light instantiated on pin 6
38.449: INFO: gpio_output        REC light instantiated on pin 21
38.452: INFO: redis_controller   Changed value: framecount = 0
38.452: INFO: redis_controller   Changed value: rec = 0
38.454: INFO: redis_controller   Changed value: sensor = imx477
38.454: INFO: redis_controller   Changed value: fps_max = 50
38.455: INFO: cinepi_controller  Settings loaded successfully.
38.455: INFO: cinepi_controller  Initialized fps_steps: [1, 2, 4, 8, 12, 16, 18, 24, 25, 33, 40, 50]
38.455: INFO: cinepi_controller  Initialized shutter_a_steps: [1, 45, 90, 135, 172.8, 180, 225, 270, 315, 346.6, 360]
38.455: INFO: redis_controller   Changed value: fps_max = 50
38.455: INFO: cinepi_controller  Loading tuning file from: /home/pi/cinemate/resources/tuning_files/imx477.json
38.461: INFO: cinepi_controller  Tuning data loaded successfully.
38.462: INFO: cinepi_controller  'rpi.awb' data found: {'priors': [{'lux': 0, 'prior': [2000, 1.0, 3000, 0.0, 13000, 0.0]}, {'lux': 800, 'prior': [2000, 0.0, 6000, 2.0, 13000, 2.0]}, {'lux': 1500, 'prior': [2000, 0.0, 4000, 1.0, 6000, 6.0, 6500, 7.0, 7000, 1.0, 13000, 1.0]}], 'modes': {'auto': {'lo': 2500, 'hi': 7700}, 'incandescent': {'lo': 2500, 'hi': 3000}, 'tungsten': {'lo': 3000, 'hi': 3500}, 'fluorescent': {'lo': 4000, 'hi': 4700}, 'indoor': {'lo': 3000, 'hi': 5000}, 'daylight': {'lo': 5500, 'hi': 6500}, 'cloudy': {'lo': 7000, 'hi': 8000}}, 'bayes': 1, 'ct_curve': [2850.0, 0.4307, 0.3957, 2960.0, 0.4159, 0.4313, 3580.0, 0.3771, 0.5176, 4559.0, 0.3031, 0.6573, 5881.0, 0.2809, 0.6942, 7600.0, 0.2263, 0.7762], 'sensitivity_r': 1.0, 'sensitivity_b': 1.0, 'transverse_pos': 0.02634, 'transverse_neg': 0.02255}
38.462: INFO: cinepi_controller  Retrieved ct_curve: [2850.0, 0.4307, 0.3957, 2960.0, 0.4159, 0.4313, 3580.0, 0.3771, 0.5176, 4559.0, 0.3031, 0.6573, 5881.0, 0.2809, 0.6942, 7600.0, 0.2263, 0.7762]
38.462: INFO: cinepi_controller  Parsed temperatures: [2850.0, 2960.0, 3580.0, 4559.0, 5881.0, 7600.0]
38.462: INFO: cinepi_controller  Parsed r_values: [0.4307, 0.4159, 0.3771, 0.3031, 0.2809, 0.2263]
38.462: INFO: cinepi_controller  Parsed b_values: [0.3957, 0.4313, 0.5176, 0.6573, 0.6942, 0.7762]
38.462: INFO: cinepi_controller  Interpolating for wb step: 3200K, lower index: 1, upper index: 2
38.462: INFO: cinepi_controller  Interpolated values for 3200K - r_interp: 0.4008806451612903, b_interp: 0.4647064516129032
38.462: INFO: cinepi_controller  Calculated reciprocal cg_rb for 3200K: (2.5, 2.2)
38.462: INFO: cinepi_controller  Interpolating for wb step: 4400K, lower index: 2, upper index: 3
38.462: INFO: cinepi_controller  Interpolated values for 4400K - r_interp: 0.31511838610827375, b_interp: 0.6346112359550562
38.462: INFO: cinepi_controller  Calculated reciprocal cg_rb for 4400K: (3.2, 1.6)
38.462: INFO: cinepi_controller  Interpolating for wb step: 5600K, lower index: 3, upper index: 4
38.462: INFO: cinepi_controller  Interpolated values for 5600K - r_interp: 0.28561875945537063, b_interp: 0.686356656580938
38.462: INFO: cinepi_controller  Calculated reciprocal cg_rb for 5600K: (3.5, 1.5)
38.463: INFO: cinepi_controller  Initialized wb_cg_rb_array: {3200: (2.5, 2.2), 4400: (3.2, 1.6), 5600: (3.5, 1.5)}
38.463: INFO: cinepi_controller  Settings loaded successfully.
38.463: INFO: cinepi_controller  Received set_fps call with value: 33.0
38.463: INFO: cinepi_controller  Retrieved max_fps from Redis: 50
38.463: INFO: cinepi_controller  Calculated safe_value: 33.0
38.464: INFO: cinepi_controller  Setting fps to 33.0
38.464: INFO: redis_controller   Changed value: fps = 33.0
38.464: INFO: cinepi_controller  [1, 45, 90, 135, 172.8, 180, 225, 270, 315, 346.6, 360]
38.465: INFO: cinepi_controller  Initialized fps: 33
38.465: INFO: redis_controller   Changed value: fps_last = 33.0
38.465: INFO: redis_controller   Changed value: fps_last = 33.0
38.466: INFO: redis_controller   Changed value: sensor_mode = 0
38.466: INFO: redis_controller   Changed value: height = 1080
38.467: INFO: redis_controller   Changed value: width = 2028
38.467: INFO: redis_controller   Changed value: bit_depth = 12
38.468: INFO: cinepi_controller  Resolution set to mode 0, height: 1080, width: 2028, gui_layout: 0
38.468: INFO: redis_controller   Changed value: fps_max = 50
38.468: INFO: redis_controller   Changed value: gui_layout = 0
38.468: INFO: redis_controller   Changed value: file_size = 3.2
38.468: INFO: redis_controller   Changed value: cam_init = 1
38.968: INFO: cinepi_app         Restarting CinePi instance.
38.969: INFO: redis_controller   Changed value: fps_last = 33.0
39.227: INFO: sensor_detect      cinepi-raw output: Available cameras
-----------------
0 : imx477 [4056x3040 12-bit RGGB] (/base/axi/pcie@120000/rp1/i2c@80000/imx477@1a)
    Modes: 'SRGGB10_CSI2P' : 1332x990 [120.05 fps - (696, 528)/2664x1980 crop]
           'SRGGB12_CSI2P' : 2028x1080 [50.03 fps - (0, 440)/4056x2160 crop]
                             2028x1520 [40.01 fps - (0, 0)/4056x3040 crop]
                             4056x3040 [10.00 fps - (0, 0)/4056x3040 crop]


39.227: INFO: sensor_detect      Detected camera model: imx477
39.228: WARNING: sensor_detect      cinepi-raw command exited with non-zero status: 134
39.228: WARNING: sensor_detect      stderr: terminate called after throwing an instance of 'std::system_error'
  what():  Invalid argument
Aborted

39.229: INFO: redis_controller   Changed value: anamorphic_factor = 1
39.229: INFO: cinepi_app         Corrected Preview Window -> x=94, y=79, width=1732, height=922, aspect_ratio=1.88
39.229: INFO: redis_controller   Changed value: lores_width = 1352
39.229: INFO: cinepi_app         Issuing ['cinepi-raw', '--mode', '2028:1080:12:U', '--width', '2028', '--height', '1080', '--lores-width', '1352', '--lores-height', '720', '-p', '94,79,1732,922', '--post-process-file', '/home/pi/post-processing.json', '--shutter', '20000', '--awbgains', '3.2,1.6', '--awb', 'auto']
39.230: INFO: redis_controller   Changed value: lores_height = 720
39.231: INFO: redis_controller   Changed value: sensor = imx477
39.231: INFO: cinepi_controller  Received set_fps call with value: 33.0
39.231: INFO: cinepi_controller  Retrieved max_fps from Redis: 50
39.231: INFO: cinepi_controller  Calculated safe_value: 33.0
39.232: INFO: cinepi_controller  Setting fps to 33.0
39.232: INFO: redis_controller   Changed value: fps = 33.0
39.232: INFO: cinepi_controller  [1, 45, 90, 135, 172.8, 180, 225, 270, 315, 346.6, 360]
39.233: INFO: cinepi_controller  Initialized fps_steps: [1, 2, 4, 8, 12, 16, 18, 24, 25, 33, 40, 50]
39.233: INFO: redis_controller   Changed value: fps_last = 33.0
39.234: INFO: cinepi_controller  [1, 45, 90, 135, 172.8, 180, 225, 270, 315, 346.6, 360]
39.234: INFO: redis_controller   Changed value: fps_max = 50
39.235: INFO: redis_controller   Changed value: sensor = imx477
39.658: INFO: redis_listener     Framecount is changing
39.659: INFO: redis_controller   Changed value: rec = 1
40.213: INFO: redis_listener     Drop frame detected
40.235: INFO: gpio_input         Button on pin 5:
40.235: INFO: redis_controller   Changed value: fps = 33.0
41.213: INFO: gpio_input           Press: rec
41.244: INFO: gpio_input         Button on pin 13:
41.244: INFO: gpio_input           Press: inc_iso
41.245: INFO: gpio_input         Button on pin 10:
41.245: INFO: gpio_input           Press: dec_iso
41.246: INFO: gpio_input         Button on pin 16:
41.246: INFO: gpio_input           Press: set_fps_double
41.247: INFO: gpio_input         Button on pin 26:
41.247: INFO: gpio_input           Single Click: set_resolution
41.247: INFO: gpio_input           Double Click: restart_camera
41.247: INFO: gpio_input           Triple Click: reboot
41.247: INFO: gpio_input           Hold: unmount
41.248: INFO: gpio_input         Two-way switch on pin 27:
41.248: INFO: gpio_input           State ON action: set_all_lock
41.248: INFO: gpio_input           State OFF action: set_all_lock
41.713: INFO: redis_listener     Drop frame flag reset
41.731: INFO: redis_listener     Framecount is stable
41.733: INFO: redis_controller   Changed value: rec = 0
41.749: INFO: gpio_input         Detected initial state: on for switch on pin 27
41.749: INFO: cinepi_controller  ISO lock False
41.749: INFO: cinepi_controller  Shutter angle lock False
41.749: INFO: cinepi_controller  FPS lock False
41.749: INFO: gpio_input         Executed action set_all_lock(0)
41.749: INFO: gpio_input         Initialized SimpleSwitch on pin 27 (pull_up=True, debounce=0.1s)
41.749: INFO: gpio_input         Two-way switch on pin 22:
41.749: INFO: gpio_input           State ON action: set_shutter_a_sync_mode
41.749: INFO: gpio_input           State OFF action: set_shutter_a_sync_mode
42.250: INFO: gpio_input         Detected initial state: on for switch on pin 22
42.250: INFO: cinepi_controller  Shutter Sync Mode deactivated
42.250: INFO: cinepi_controller  Shutter sync disabled
42.251: INFO: gpio_input         Executed action set_shutter_a_sync_mode(0)
42.251: INFO: gpio_input         Initialized SimpleSwitch on pin 22 (pull_up=True, debounce=0.1s)
42.251: INFO: gpio_input         Rotary Encoder with Button on CLK pin: 9, DT pin: 11
42.251: INFO: gpio_input           Rotate Clockwise: inc_iso
42.251: INFO: gpio_input           Rotate CounterClockwise: dec_iso
42.252: INFO: gpio_input         Rotary Encoder with Button on CLK pin: 23, DT pin: 25
42.252: INFO: gpio_input           Rotate Clockwise: inc_shutter_a_nom
42.252: INFO: gpio_input           Rotate CounterClockwise: dec_shutter_a_nom
42.253: INFO: gpio_input         Rotary Encoder with Button on CLK pin: 8, DT pin: 7
42.253: INFO: gpio_input           Rotate Clockwise: inc_fps
42.254: INFO: gpio_input           Rotate CounterClockwise: dec_fps
42.255: INFO: gpio_input         Rotary Encoder with Button on CLK pin: 12, DT pin: 20
42.255: INFO: gpio_input           Rotate Clockwise: inc_wb
42.255: INFO: gpio_input           Rotate CounterClockwise: dec_wb
43.405: WARNING: gpio_input         No I2C device found at address: 0x49. Quad Rotary Encoder not initialized.
43.408: INFO: redis_controller   Changed value: framecount = 0
43.408: INFO: redis_controller   Changed value: rec = 0
43.409: INFO: simple_gui         HDMI display found. (1920, 1080)
setterm: $TERM is not defined.
Exception in thread Thread-19:
Traceback (most recent call last):
  File "/usr/lib/python3.11/threading.py", line 1038, in _bootstrap_inner
    self.run()
  File "/home/pi/cinemate/src/module/cli_commands.py", line 145, in run
    data = input("\n> ")  # Read the input as a single string
           ^^^^^^^^^^^^^
EOFError: EOF when reading a line
43.684: INFO: main               Stream module loaded
43.684: INFO: mediator           Mediator instantiated
44.688: INFO: main               Loaded WB steps: [3200, 4400, 5600]
44.689: INFO: analog_controls    Grove Base HAT found!
44.690: INFO: analog_controls    Setting ISO to 2500
44.691: INFO: cinepi_controller  Setting iso to 2500
44.694: INFO: redis_controller   Changed value: iso = 2500
44.694: INFO: analog_controls    Setting Shutter Angle to 172.8
44.696: INFO: cinepi_controller  Setting shutter_a_nom to 172.8
44.697: INFO: redis_controller   Changed value: shutter_a_nom = 172.8
44.711: INFO: cinepi_controller  Setting shutter_a to 172.8 degrees
44.712: INFO: redis_controller   Changed value: shutter_a = 172.8
44.712: INFO: PWMcontroller      Setting PWM with fps=None, shutter_angle=172.8
44.712: INFO: PWMcontroller      PWM duty cycle calculated and set to 31456
44.712: INFO: PWMcontroller      Updating PWM with cycles=1
44.712: INFO: analog_controls    Setting FPS to 33
44.713: INFO: cinepi_controller  Received set_fps call with value: 33.0
44.713: INFO: cinepi_controller  Retrieved max_fps from Redis: 50
44.713: INFO: cinepi_controller  Calculated safe_value: 33.0
44.713: INFO: cinepi_controller  Setting fps to 33.0
44.714: INFO: cinepi_controller  [1, 45, 90, 135, 172.8, 180, 225, 270, 315, 346.6, 360]
44.715: INFO: analog_controls    Setting White Balance to 4400K
44.716: INFO: cinepi_controller  Set white balance for 4400K: (3.2, 1.6)
44.750: INFO: PWMcontroller      PWM duty cycle set to 47.998779278248264% on pins 19, None
44.751: INFO: redis_controller   Changed value: fps = 33.0
44.751: INFO: PWMcontroller      Setting PWM with fps=33.0, shutter_angle=None
44.751: INFO: PWMcontroller      PWM frequency set to 33.0Hz on pins 19, None
44.751: INFO: PWMcontroller      Shutter angle is None, keeping existing duty cycle.
44.751: INFO: PWMcontroller      Updating PWM with cycles=1
44.793: INFO: PWMcontroller      PWM duty cycle set to 47.998779278248264% on pins 19, None
44.798: INFO: redis_controller   Changed value: fps_last = 33.0
44.801: INFO: redis_controller   Changed value: wb_user = 4400
44.804: INFO: redis_controller   Changed value: cg_rb = 3.2,1.6
44.804: INFO: redis_controller   Changed value: wb_user = 4400
45.043: INFO: cinepi_controller  Trigger mode set to 0
45.047: INFO: cinepi_app         Restarting CinePi instance.
45.048: INFO: redis_controller   Changed value: trigger_mode = 0
45.052: INFO: cinepi_app         Shutting down CinePi instance.
45.053: INFO: redis_controller   Changed value: fps_last = 33.0
45.072: INFO: redis_controller   Changed value: fps_last = 33.0
45.125: INFO: cinepi_app         CinePi instance shut down.
45.478: INFO: sensor_detect      cinepi-raw output: Available cameras
-----------------
0 : imx477 [4056x3040 12-bit RGGB] (/base/axi/pcie@120000/rp1/i2c@80000/imx477@1a)
    Modes: 'SRGGB10_CSI2P' : 1332x990 [120.05 fps - (696, 528)/2664x1980 crop]
           'SRGGB12_CSI2P' : 2028x1080 [50.03 fps - (0, 440)/4056x2160 crop]
                             2028x1520 [40.01 fps - (0, 0)/4056x3040 crop]
                             4056x3040 [10.00 fps - (0, 0)/4056x3040 crop]


45.480: INFO: sensor_detect      Detected camera model: imx477
45.480: WARNING: sensor_detect      cinepi-raw command exited with non-zero status: 134
45.480: WARNING: sensor_detect      stderr: terminate called after throwing an instance of 'std::system_error'
  what():  Invalid argument
Aborted

45.488: INFO: cinepi_app         Corrected Preview Window -> x=94, y=79, width=1732, height=922, aspect_ratio=1.88
45.491: INFO: cinepi_app         Issuing ['cinepi-raw', '--mode', '2028:1080:12:U', '--width', '2028', '--height', '1080', '--lores-width', '1352', '--lores-height', '720', '-p', '94,79,1732,922', '--post-process-file', '/home/pi/post-processing.json', '--shutter', '20000', '--awbgains', '3.2,1.6', '--awb', 'auto']
45.493: INFO: redis_controller   Changed value: anamorphic_factor = 1
45.496: INFO: redis_controller   Changed value: lores_width = 1352
45.499: INFO: redis_controller   Changed value: lores_height = 720
45.503: INFO: main               Trigger mode set to 0 using cinepi_controller.
45.506: INFO: redis_controller   Changed value: sensor = imx477
45.508: INFO: main               Initialized WB steps: [3200, 4400, 5600]
45.521: INFO: cinepi_controller  Set white balance for 4400K: (3.2, 1.6)
45.522: INFO: redis_controller   Changed value: cg_rb = 3.2,1.6
45.523: INFO: main               --- initialization complete
45.524: INFO: redis_controller   Changed value: wb_user = 4400
46.018: INFO: redis_listener     Framecount is changing
46.018: INFO: redis_controller   Changed value: rec = 1
46.018: INFO: mediator           Recording started!
46.020: INFO: gpio_output        GPIO 6 set to HIGH
46.020: INFO: redis_listener     Framecount is changing
46.020: INFO: gpio_output        GPIO 21 set to HIGH
46.022: INFO: redis_controller   Changed value: rec = 1
46.035: INFO: mediator           Recording started!
46.036: INFO: gpio_output        GPIO 6 set to HIGH
46.036: INFO: gpio_output        GPIO 21 set to HIGH
46.526: INFO: redis_controller   Changed value: fps = 33.0
46.527: INFO: PWMcontroller      Setting PWM with fps=33.0, shutter_angle=None
46.527: INFO: PWMcontroller      PWM frequency set to 33.0Hz on pins 19, None
46.527: INFO: PWMcontroller      Shutter angle is None, keeping existing duty cycle.
46.527: INFO: PWMcontroller      Updating PWM with cycles=1
46.542: INFO: PWMcontroller      PWM duty cycle set to 47.998779278248264% on pins 19, None
46.554: INFO: redis_listener     Drop frame detected
46.554: INFO: redis_listener     Drop frame detected
47.069: INFO: redis_listener     Drop frame flag reset
47.075: INFO: redis_listener     Drop frame flag reset
47.135: INFO: redis_listener     Framecount is stable
47.140: INFO: redis_listener     Framecount is stable
47.141: INFO: redis_controller   Changed value: rec = 0
47.148: INFO: mediator           Recording stopped!
47.149: INFO: gpio_output        GPIO 6 set to LOW
47.149: INFO: gpio_output        GPIO 21 set to LOW
47.149: INFO: redis_controller   Changed value: rec = 0
47.149: INFO: mediator           Recording stopped!
47.149: INFO: gpio_output        GPIO 6 set to LOW
47.150: INFO: gpio_output        GPIO 21 set to LOW
